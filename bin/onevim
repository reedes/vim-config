#/bin/bash
# Name       : mvim
# Description: Use MacVim in a single instance
#
# Author     : reedes
# Created    : February 17, 2014
#
# Based on a script by Wout Mertens and suggestions from Laurent Bihanic.  This
# version is the fault of Benji Fisher, 16 May 2005 (with modifications by Nico
# Weber and Bjorn Winckler, Aug 13 2007).

VIM_APP_DIR=/usr/local/Cellar/macvim/7.4-72

if [ -z "$VIM_APP_DIR" ]
then
  myDir="`dirname "$0"`"
  myAppDir="$myDir/../Applications"
  for i in ~/Applications ~/Applications/vim $myDir $myDir/vim $myAppDir $myAppDir/vim /Applications /Applications/vim /Applications/Utilities /Applications/Utilities/vim; do
    if [ -x "$i/MacVim.app" ]; then
      VIM_APP_DIR="$i"
      break
    fi
  done
fi
if [ -z "$VIM_APP_DIR" ]
then
  echo "Sorry, cannot find MacVim.app.  Try setting the VIM_APP_DIR environment variable to the directory containing MacVim.app."
  exit 1
fi
binary="$VIM_APP_DIR/MacVim.app/Contents/MacOS/Vim"

# load a single instance
VIM_SERVER=$( mvim --serverlist | head -n1 )

if [ -n "$1" ] ; then
  if [ -n "$VIM_SERVER" ]; then
    exec "$binary" -g --server-name=$VIM_SERVER --remote-send ":call foreground()<CR><C-\><C-n>:split $@<CR>"
  else
    exec "$binary" -g --remote-silent "$@"
  fi
elif [ -n "$VIM_SERVER" ] ; then
  exec "$binary" -g --server-name=$VIM_SERVER --remote-send ":call foreground()<CR>:enew<CR>:<BS>"
else
  exec "$binary" -g
fi
